<!DOCTYPE html>





<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> GitLab Omnibus</title>
<meta name="viewport" content="width=device-width, initial-scale=1">  
<meta http-equiv="content-language" content="en-us" />

<meta name="og:site_name" value="Mattermost.com">
<meta name="og:title" value="GitLab Omnibus">

 
  <meta name="description" content="Information on updating and building GitLab Omnibus with new versions of Mattermost">
<meta name="twitter:description" content="Information on updating and building GitLab Omnibus with new versions of Mattermost">
<meta name="og:description" content="Information on updating and building GitLab Omnibus with new versions of Mattermost">



 
<link rel="canonical" href="https://developers.mattermost.com/internal/gitlab-omnibus/">


<link rel="shortcut icon" type="image/png" href="https://developers.mattermost.com/img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="https://developers.mattermost.com/css/bootstrap.min.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/tabs.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/bar.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/styles.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/code.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/note.css">

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53S4TVZ');</script>


    </head>
<body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53S4TVZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    
<header class="with-notification-bar">

    <a href="https://developers.mattermost.com/"><img src="https://developers.mattermost.com/img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="https://developers.mattermost.com/">Home</a></li>
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/contribute/getting-started/">Contribute</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/integrate/getting-started/">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/extend/getting-started/">Extend</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/blog/">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>


<div class='notification-bar sticky-top'>
    <div class="notification-bar__content">
        <a class="notification-bar__close">
            <span aria-hidden="true">×</span>
        </a>
        <a href="https://mattermost.com/careers">
            We&#39;re hiring!
        </a>
    </div>
</div>




    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 sidebar">
    <div class="sidebar__menu-toggle">
        GitLab Omnibus
        <i class="fa fa-bars pull-right"></i>
    </div>
    <div class="row sidebar__links">
        
            
        
            
        
            
        
            
            
                
                

                
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/internal/infrastructure/"> Infrastructure</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/kubernetes/"> Kubernetes</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                            
                                <span class="item ">
                                
                                    <a href="https://developers.mattermost.com/internal/infrastructure/kubernetes/kubernetes-troubleshooting/"> Kubernetes Maintenance</a>
                                
                                </span>
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/grafana/"> Community Grafana</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/vpn-cloud/"> VPN(CLOUD)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/plugins/"> Adding a Plugin to Community</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/aws/"> AWS</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/onelogin-aws/"> OneLogin and AWS</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/build/"> Build</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/infrastructure/guidelines/"> Guidelines for New Infrastructure</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/qa/"> QA</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/offboarding/"> Offboarding</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/internal/onboarding/"> Onboarding</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/onboarding/new-staff-guide/"> New Staff Guide</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/onboarding/manager-guide/"> Manager Guide</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
                
                

                
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/internal/mobile-build-process/"> Mobile Build Process</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/mobile-build-process/bump-version-number/"> Bump Version Number</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/mobile-build-process/bump-build-number/"> Bump Build Number</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/internal/mobile-build-process/troubleshooting/"> Troubleshooting</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/release-tagging-process/"> Release Tagging Process</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/release-process/"> Release Cutting Process</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/plugin-release-process/"> Plugin Release Process</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/tips-and-best-practices/"> Tips and Best Practices</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/writing-a-blog-post/"> Writing a Blog Post</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/rd-teams/"> R&amp;D Teams</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/internal/sustained-engineering/"> Sustained Engineering Team</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                
                    
                

                
                
                    
                

                <span class="item active">
                    <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a class="active" href="#"> GitLab Omnibus</a>
                    
                </span>

                <ul class="sub-menu" style="display: block">
                    
                </ul>
            
            
        
            
        
    </div>
</div>

                <div class="col-lg-9 doc-content">
                    
<a href="https://github.com/mattermost/mattermost-developer-documentation/edit/master/site/content/internal/gitlab-omnibus.md" class="float-right edit-github">
    Edit on GitHub
</a>


                    <h1 class="mt-0 doc-title">
                        
                            GitLab Omnibus Release Process
                        
                    </h1>
                    <p>GitLab&rsquo;s Omnibus package bundles Mattermost Team Edition (TE) as an optional feature that can be enabled during installation. While GitLab maintains most of this integration, we send them new versions of Mattermost and occasionally assist with support on issues that relate to Mattermost.</p>
<p>For every monthly GitLab release, we submit a merge request (MR) to <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/">GitLab&rsquo;s repository</a> to update the embedded version of Mattermost. GitLab releases in the middle of the month, so we&rsquo;ll generally submit the newest version of Mattermost to them at the start of the month to give time for the review process to happen.</p>
<h3 id="setting-up-gitlab-omnibus-for-development">Setting up GitLab Omnibus for development&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#setting-up-gitlab-omnibus-for-development"></i></a> </h3>
<p>We maintain <a href="https://gitlab.com/mattermost/omnibus-gitlab">our own fork of GitLab Omnibus</a> for use when submitting merge requests upstream. This should be cloned and kept up to date to ensure that we&rsquo;re testing and submitting against the latest code.</p>
<p>These are the steps for checking out GitLab Omnibus and installing its dependencies:</p>
<ol>
<li>
<p>Clone our fork.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://gitlab.com/mattermost/omnibus-gitlab.git
</code></pre></div></li>
<li>
<p>Add the upstream repository as a git remote.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git remote add upstream https://gitlab.com/gitlab-org/omnibus-gitlab.git
</code></pre></div></li>
<li>
<p>Install Docker. GitLab packages all dependencies for building GitLab Omnibus in a Docker image which will be pulled later.</p>
</li>
</ol>
<h3 id="submitting-a-new-version-of-mattermost">Submitting a new version of Mattermost&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#submitting-a-new-version-of-mattermost"></i></a> </h3>
<p>These are the steps to update GitLab Omnibus with a new version of Mattermost:</p>
<ol>
<li>
<p>Ensure our fork&rsquo;s master branch is up to date with upstream.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git checkout master
git fetch upstream
git pull upstream master
git push
</code></pre></div></li>
<li>
<p>Create a branch for the new version of Mattermost.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git checkout -b mattermost-X.Y
</code></pre></div></li>
<li>
<p>Update the version of Mattermost downloaded at build time by modifying <code>config/software/mattermost.rb</code>. The <code>default_version</code> and <code>md5</code> fields need to be set to the match the latest release of Mattermost TE.</p>
</li>
<li>
<p>Add an entry to the table in <code>doc/gitlab-mattermost/README.md</code> that maps GitLab versions to the corresponding Mattermost version. This step is not necessary for dot releases of Mattermost.</p>
</li>
<li>
<p>Commit the changes made to <code>config/software/mattermost.rb</code> and <code>doc/gitlab-mattermost/README.md</code>. The commit message is used to generate a changelog entry, so it must include a second line containing the type of change made. For regular releases, it should be the following:</p>
<pre><code>Update Mattermost to X.Y

Changelog: other
</code></pre></li>
</ol>
<p>For security backports, the type should be changed to &ldquo;security&rdquo;.</p>
<p>You can now test the build and submit an MR upstream. For an example of how the branch should look after that, see <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/-/merge_requests/5068">here</a>.</p>
<h3 id="building-gitlab-omnibus">Building GitLab Omnibus&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#building-gitlab-omnibus"></i></a> </h3>
<p>As mentioned above, GitLab Omnibus is built in a Docker container containing all of the needed dependencies. To test it, the generated <code>.deb</code> package needs to be copied off of the Docker container and installed locally on the test server. Details on how to do that follow.</p>
<p>These steps differ slightly from the more detailed ones available from GitLab (<a href="https://gitlab.com/gitlab-org/omnibus-gitlab/-/blob/master/doc/build/build_package.md">link</a>) since they were changed to keep the Git repository outside of Docker container, but they still work as of March 4, 2021.</p>
<ol>
<li>
<p>Get the current <code>BUILDER_IMAGE_REVISION</code> value from <code>.gitlab-ci.yml</code>.</p>
</li>
<li>
<p>Run the builder in a Docker container. You may have to run these with <code>sudo</code> depending on permissions. This assumes you&rsquo;re using Ubuntu 18.04, but there are other Docker images available for different OSes.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull registry.gitlab.com/gitlab-org/gitlab-omnibus-builder/ubuntu_18.04:<span style="color:#a00">${</span><span style="color:#033">BUILDER_IMAGE_REVISION</span><span style="color:#a00">}</span>
docker run -it registry.gitlab.com/gitlab-org/gitlab-omnibus-builder/ubuntu_18.04:<span style="color:#a00">${</span><span style="color:#033">BUILDER_IMAGE_REVISION</span><span style="color:#a00">}</span> bash
</code></pre></div></li>
<li>
<p>Inside the container, clone the repo and change to the folder. Note that we&rsquo;re cloning our fork here.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://gitlab.com/mattermost/omnibus-gitlab.git ~/omnibus-gitlab
<span style="color:#366">cd</span> ~/omnibus-gitlab
</code></pre></div></li>
<li>
<p>Change to the correct branch.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git checkout mattermost-X.Y
</code></pre></div></li>
<li>
<p>Specify where to grab GitLab dependencies and assets from.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#366">export</span> <span style="color:#033">ALTERNATIVE_SOURCES</span><span style="color:#555">=</span><span style="color:#366">true</span>
<span style="color:#366">export</span> <span style="color:#033">ASSET_REGISTRY</span><span style="color:#555">=</span>registry.gitlab.com
<span style="color:#366">export</span> <span style="color:#033">COMPILE_ASSETS</span><span style="color:#555">=</span><span style="color:#366">true</span>
</code></pre></div></li>
<li>
<p>Install Ruby dependencies.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bundle install
bundle binstubs --all
</code></pre></div></li>
<li>
<p>Build everything. This can take a couple of hours, so go grab lunch.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bin/omnibus build gitlab
</code></pre></div></li>
<li>
<p>From the host machine, copy the compiled package out of the Docker container.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker cp &lt;container&gt;:/root/omnibus-gitlab/pkg/&lt;package&gt;.deb .
</code></pre></div></li>
</ol>
<p>Note that Docker likes to eat up space on the disk without cleaning up after itself, so you&rsquo;ll want to remove old Docker containers with <code>docker rm</code> after building and copying the package to the host machine.</p>
<h3 id="installing-and-configuring-gitlab-omnibus">Installing and configuring GitLab Omnibus&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#installing-and-configuring-gitlab-omnibus"></i></a> </h3>
<p>To install GitLab Omnibus with Mattermost, you&rsquo;ll need to configure your DNS with two domain names for the test server: one for GitLab and one for Mattermost. The following steps will use <code>gitlab.dev.mm</code> and <code>mattermost.dev.mm</code> as those domains.</p>
<p>The package generated above can be installed with <code>sudo dpkg -i &lt;package&gt;.deb</code>.</p>
<p>After first installing GitLab Omnibus, the external URLs for GitLab need to be configured, and Mattermost needs to be enabled in the GitLab config. To do that:</p>
<ol>
<li>
<p>Open <code>/etc/gitlab/gitlab.rb</code> using vi or your preferred text editor.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo vi /etc/gitlab/gitlab.rb
</code></pre></div></li>
<li>
<p>Set the <code>external_url</code> to set GitLab&rsquo;s external URL.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">external_url <span style="color:#c30">&#34;http://gitlab.dev.mm&#34;</span>
</code></pre></div></li>
<li>
<p>Find and uncomment the line which sets <code>mattermost_external_url</code> and set it to Mattermost&rsquo;s external URL.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">mattermost_external_url <span style="color:#c30">&#34;http://mattermost.dev.mm&#34;</span>
</code></pre></div></li>
<li>
<p>Find and uncomment the line which sets <code>mattermost['enable']</code> and set it to <code>true</code>.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">mattermost<span style="color:#555">[</span><span style="color:#c30">&#39;enable&#39;</span><span style="color:#555">]</span> <span style="color:#555">=</span> <span style="color:#069">true</span>
</code></pre></div></li>
<li>
<p>Leave your editor and use <code>gitlab-ctl</code> to reconfigure and restart its services.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo gitlab-ctl reconfigure
</code></pre></div></li>
</ol>
<p>After a few minutes, Mattermost and GitLab should be accessible from their respective URLs and GitLab sign-in should be automatically configured in Mattermost. The default admin login on GitLab has the username <code>root</code> and the password <code>5iveL!fe</code>.</p>
<p>A few more commands for working with GitLab can be found <a href="https://docs.mattermost.com/process/support.html#other-debugging-information">in our support documentation</a>.</p>
<h3 id="testing-mattermost-in-gitlab-omnibus">Testing Mattermost in GitLab Omnibus&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#testing-mattermost-in-gitlab-omnibus"></i></a> </h3>
<p>To test a new version of Mattermost running in GitLab, you&rsquo;ll have to test the three main ways they interact: logging in, creating a Mattermost team for a GitLab group, and adding notifications/slash commands to Mattermost. Using the same URLs as above, the steps for testing are:</p>
<ol>
<li>
<p>Test signing into Mattermost, once when not logged into GitLab and then again after having already logged in.</p>
<ol>
<li>
<p>Visit <code>http://mattermost.dev.mm</code> in a browser.</p>
</li>
<li>
<p>Select <strong>Sign in with GitLab</strong>. You should be directed to the GitLab login screen.</p>
</li>
<li>
<p>Log in as any user. You should be sent back to Mattermost and logged in.</p>
</li>
<li>
<p>Log out and back in through the same process. You should skip the GitLab login screen since you were still logged into GitLab.</p>
</li>
</ol>
</li>
<li>
<p>Test creating a team in Mattermost for a new GitLab group.</p>
<ol>
<li>
<p>Open <code>http://gitlab.dev.mm</code> in another window.</p>
</li>
<li>
<p>Select the plus icon in the header bar and select <strong>New group</strong>.</p>
</li>
<li>
<p>Enter a name for the group and check <strong>Create a Mattermost team for this group</strong>.</p>
</li>
<li>
<p>Go back to Mattermost. You should have been added to a new team matching the name of the group.</p>
</li>
</ol>
</li>
<li>
<p>Test adding the GitLab slash command.</p>
<ol>
<li>
<p>Go to GitLab.</p>
</li>
<li>
<p>Select the plus icon in the header bar and select <strong>New project</strong>.</p>
</li>
<li>
<p>Select <strong>Create blank project</strong>. Enter a name and choose <strong>Create project</strong>.</p>
</li>
<li>
<p>From the sidebar on the left, go to <strong>Settings &gt; Integrations</strong>.</p>
</li>
<li>
<p>Scroll down and select <strong>Mattermost slash commands</strong>.</p>
</li>
<li>
<p>Select <strong>Add to Mattermost</strong>.</p>
</li>
<li>
<p>Select the team you created above from the drop-down, then choose <strong>Install</strong>.</p>
</li>
<li>
<p>Go back to Mattermost and use <code>/&lt;project&gt;</code>.</p>
</li>
<li>
<p>When prompted, select <strong>Connect your GitLab Account</strong>, then choose <strong>Authorize</strong>.</p>
</li>
<li>
<p>You should now be able to use the slash command to do things like creating and viewing issues.</p>
</li>
</ol>
</li>
<li>
<p>Test adding GitLab notifications.</p>
<ol>
<li>
<p>In Mattermost, go to <strong>Integrations &gt; Incoming Webhooks</strong> and add an incoming webhook.</p>
</li>
<li>
<p>Copy the URL of the webhook and return to Mattermost.</p>
</li>
<li>
<p>Go to GitLab. From the sidebar on the left, go to <strong>Settings &gt; Integrations</strong>.</p>
</li>
<li>
<p>Scroll down and select <strong>Mattermost notifications</strong>.</p>
</li>
<li>
<p>Paste the previously copied webhook URL into the <strong>Webhook</strong> field, then select <strong>Save changes</strong>.</p>
</li>
<li>
<p>Create an issue either from the GitLab UI or by using the previously configured slash command. A notification should be posted by the webhook in the channel you created.</p>
</li>
</ol>
</li>
</ol>
<h3 id="useful-files-and-commands">Useful Files and Commands&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#useful-files-and-commands"></i></a> </h3>
<p>When working on GitLab Omnibus, the following files might be useful:</p>
<ul>
<li><code>config/software/mattermost.rb</code> - The script for downloading Mattermost during GitLab Omnibus&rsquo;s build and extracting the required files for it.</li>
<li><code>doc/gitlab-mattermost/README.md</code> - GitLab&rsquo;s documentation for using the embedded version of Mattermost.</li>
<li><code>files/gitlab-cookbooks/mattermost/libraries/mattermost_helper.rb</code> - The list of environment variables that GitLab Omnibus passes to Mattermost.</li>
<li><code>files/gitlab-cookbooks/mattermost/recipes/enable.rb</code> - The script to set up the required files and folders for Mattermost after installation.</li>
</ul>
<p>After installing GitLab Omnibus, the following files and folders might be useful:</p>
<ul>
<li><code>/etc/gitlab/gitlab.rb</code> - The configuration files for GitLab Omnibus itself. <code>gitlab reconfigure [&lt;service&gt;]</code> must be called to apply any changes made.</li>
<li><code>/var/opt/gitlab/mattermost/config.json</code> - The location of Mattermost&rsquo;s <code>config.json</code>.</li>
<li><code>/var/log/gitlab/mattermost/logs/current</code> - The logs for Mattermost.</li>
<li><code>/var/opt/gitlab/mattermost/data</code> - The data directory for Mattermost.</li>
<li><code>/opt/gitlab/embedded/service/mattermost</code> - The static files used by Mattermost (web app code, i18n strings, email templates, etc).</li>
</ul>


                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script src="https://developers.mattermost.com/js/tabs.js"></script>
<script src="https://developers.mattermost.com/js/main.js"></script>

</body>
</html>
