<!DOCTYPE html>





<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> Deployment (Admins)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">  
<meta http-equiv="content-language" content="en-us" />

<meta name="og:site_name" value="Mattermost.com">
<meta name="og:title" value="Deployment (Admins)">

 
  <meta name="description" content="TODO">
<meta name="twitter:description" content="TODO">
<meta name="og:description" content="TODO">



 
<link rel="canonical" href="https://developers.mattermost.com/integrate/apps/deployment-aws/deploy-to-aws/">


<link rel="shortcut icon" type="image/png" href="https://developers.mattermost.com/img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="https://developers.mattermost.com/css/bootstrap.min.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/tabs.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/bar.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/styles.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/code.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/note.css">

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53S4TVZ');</script>


    </head>
<body>
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53S4TVZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    
<header class="with-notification-bar">

    <a href="https://developers.mattermost.com/"><img src="https://developers.mattermost.com/img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="https://developers.mattermost.com/">Home</a></li>
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/contribute/getting-started/">Contribute</a></li>
                
            
        
            
            
            
                
                    <li class="active"><a href="https://developers.mattermost.com/integrate/getting-started/">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/extend/getting-started/">Extend</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/blog/">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>


<div class='notification-bar sticky-top'>
    <div class="notification-bar__content">
        <a class="notification-bar__close">
            <span aria-hidden="true">×</span>
        </a>
        <a href="https://mattermost.com/careers">
            We&#39;re hiring!
        </a>
    </div>
</div>




    <div id="wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 sidebar">
    <div class="sidebar__menu-toggle">
        Deployment (Admins)
        <i class="fa fa-bars pull-right"></i>
    </div>
    <div class="row sidebar__links">
        
            
        
            
        
            
        
            
        
            
            
                
                

                
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/integrate/getting-started/"> Getting Started</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/getting-started/how-should-i-integrate/"> How Should I Integrate?</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/incoming-webhooks/"> Incoming Webhooks</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/outgoing-webhooks/"> Outgoing Webhooks</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/slash-commands/"> Slash Commands</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/rest-api/"> API Reference</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                

                
                
                    
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                    
                        <a href="https://developers.mattermost.com/integrate/examples/"> Examples</a>
                    
                </span>

                <ul class="sub-menu" >
                    
                </ul>
            
                
                

                
                
                    
                

                
                

                <span class="item ">
                    <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style=""></i>
                    
                        <a href="https://developers.mattermost.com/integrate/apps/"> Apps (Developers Preview)</a>
                    
                </span>

                <ul class="sub-menu" style="display: block">
                    
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/quick-start-js/"> Quick start guide (JS)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/quick-start-go/"> Quick start guide (Go)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/manifest/"> Manifest</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/call/"> Call</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/bindings/"> Bindings</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/interactivity/"> Interactivity</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                            
                                <span class="item ">
                                
                                    <a href="https://developers.mattermost.com/integrate/apps/interactivity/example-post-menu/"> Post Menu Example</a>
                                
                                </span>
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/using-mattermost-api/"> Apps APIs</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/using-third-party-api/"> Third-party APIs</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/lifecycle/"> App Lifecycle</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                        
                        

                        
                        
                            
                        

                        
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-minus-square-o" aria-hidden="true" style=""></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/deployment-aws/"> Deployment (AWS)</a>
                            
                        </span>

                        <ul class="sub-menu" style="display: block">
                            
                            
                                <span class="item ">
                                
                                    <a href="https://developers.mattermost.com/integrate/apps/deployment-aws/prepare-app/"> Preparing App (Developers)</a>
                                
                                </span>
                            
                            
                                <span class="item active">
                                
                                    <a class="active" href="#"> Deployment (Admins)</a>
                                
                                </span>
                            
                            
                                <span class="item ">
                                
                                    <a href="https://developers.mattermost.com/integrate/apps/deployment-aws/hello-lambda/"> Hello, lambda!</a>
                                
                                </span>
                            
                        </ul>
                
                        
                        

                        
                        

                        
                        
                            
                        

                        <span class="item ">
                            <i class="sub-menu__toggle fa fa-plus-square-o" aria-hidden="true" style="display: none"></i>
                            
                                <a href="https://developers.mattermost.com/integrate/apps/deployment-http/"> Deployment (HTTP Server)</a>
                            
                        </span>

                        <ul class="sub-menu" >
                            
                        </ul>
                
                </ul>
            
            
        
    </div>
</div>

                <div class="col-lg-9 doc-content">
                    
<a href="https://github.com/mattermost/mattermost-developer-documentation/edit/master/site/content/integrate/apps/deployment-aws/deploy-to-aws/_index.md" class="float-right edit-github">
    Edit on GitHub
</a>


                    <h1 class="mt-0 doc-title">
                        
                            Deploying AWS Serverless Apps (For Admins)
                        
                    </h1>
                    <p>Admins of the on-prem Mattermost instance must prepare both AWS and Mattermost before provisioning and deploying an app.</p>
<p>Note that Mattermost Cloud only allows apps hosted by Mattermost, not ones that are self-hosted.</p>
<p>Provisioning in the AWS cloud environment will be done by the <strong>appsctl</strong> tool described in the AWS Setup section.</p>
<p>We need an app bundle to provision an app. The bundle will be provisioned from S3 and consists of three parts which will be completed via the <strong>appsctl</strong> tool:</p>
<ol>
<li>Creating the lambda functions with appropriate policies.</li>
<li>Storing static assets in the dedicated S3 bucket.</li>
<li>Storing the app’s manifest file in the same dedicated S3 bucket.</li>
</ol>
<h3 id="mattermost-setup">Mattermost setup&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#mattermost-setup"></i></a> </h3>
<p>Follow the Prerequisites section of the <a href="https://developers.mattermost.com/integrate/apps/quick-start-js/">JavaScript</a> or <a href="https://developers.mattermost.com/integrate/apps/quick-start-go/">Go</a> Quick Start Guides to set up your Mattermost instance. Ensure that you install the <a href="https://developers.mattermost.com/integrate/apps/quick-start-js/#install-the-apps-plugin">apps plugin</a> as part of this process.</p>
<h3 id="aws-setup">AWS setup&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#aws-setup"></i></a> </h3>
<h3 id="1-create-aws-s3-bucket">1. Create AWS S3 bucket&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#1-create-aws-s3-bucket"></i></a> </h3>
<p>You will need to create an S3 bucket within AWS or use an existing bucket.</p>
<ol>
<li>Visit <a href="https://s3.console.aws.amazon.com">https://s3.console.aws.amazon.com</a></li>
<li>Create a bucket.</li>
<li><strong>Bucket name</strong>: Give your bucket a name.</li>
<li><strong>AWS Region</strong>:
<ol>
<li>Select your region</li>
<li>Save the slug value for later (Example: <code>us-east-1</code>)</li>
<li>Corresponding Lambdas will be provisioned in the same region</li>
</ol>
</li>
<li><strong>Block Public Access settings for this bucket</strong>
<ol>
<li>Check <strong>Block <em>all</em> public access</strong></li>
</ol>
</li>
<li>Select <strong>Create Bucket</strong>.</li>
</ol>
<h4 id="2-create-an-iam-user-access-key-and-secret">2. Create an IAM user access key and secret&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#2-create-an-iam-user-access-key-and-secret"></i></a> </h4>
<p>You will need an access key and secret so that <code>appsctl</code> can provision the app. These credentials can come from creating an IAM user, using a privileged IAM user, or even using the AWS account owners personal access key. Please follow the instructions <a href="https://aws.amazon.com/premiumsupport/knowledge-center/create-access-key/">provided by AWS</a> to complete these steps and save the <code>Access key ID</code> and <code>Secret access key</code> values.</p>
<h4 id="3-set-aws-provision-environment-variables">3. Set AWS Provision environment variables&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#3-set-aws-provision-environment-variables"></i></a> </h4>
<p>Open a terminal where you installed the Apps plugin and set the following variables to the AWS credentials just created and saved:</p>
<ul>
<li><code>MM_APPS_PROVISION_AWS_ACCESS_KEY</code></li>
<li><code>MM_APPS_PROVISION_AWS_SECRET_KEY</code></li>
</ul>
<p>Set the following environment variables based on bucket name and region</p>
<ul>
<li><code>MM_APPS_S3_BUCKET</code></li>
<li><code>MM_APPS_AWS_REGION</code></li>
</ul>
<h4 id="4-initialize-the-aws-resources">4. Initialize the AWS resources&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#4-initialize-the-aws-resources"></i></a> </h4>
<p>The following command will create a Mattermost invoke user and security policy for use with AWS.</p>
<p><code>go run ./cmd/appsctl aws init --create --create-access-key</code></p>
<p>The output of the command will contain two &ldquo;Invoke&rdquo; environment variables.</p>
<h4 id="5-set-aws-invoke-environment-variables">5. Set AWS Invoke environment variables&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#5-set-aws-invoke-environment-variables"></i></a> </h4>
<p>The second set of credentials created from the above initialization step will be used by Mattermost to invoke Apps.  Set these variables in the location of your running Mattermost server repo.</p>
<ul>
<li><code>MM_APPS_AWS_ACCESS_KEY</code></li>
<li><code>MM_APPS_AWS_SECRET_KEY</code></li>
</ul>
<h3 id="restart-the-mattermost-server">Restart the Mattermost Server&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#restart-the-mattermost-server"></i></a> </h3>
<p>Ensure you have the following environment variables set.</p>
<ul>
<li><code>MM_APPS_AWS_ACCESS_KEY</code></li>
<li><code>MM_APPS_AWS_SECRET_KEY</code></li>
<li><code>MM_APPS_S3_BUCKET</code></li>
<li><code>MM_APPS_AWS_REGION</code></li>
</ul>
<p>Restart the Mattermost server to complete your Mattermost and AWS setup. You can now deploy an app to AWS.</p>
<h3 id="test-your-aws-configuration-and-permissions">Test your AWS configuration and permissions&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#test-your-aws-configuration-and-permissions"></i></a> </h3>
<p>Run the following commands to test and validate your AWS configuration and permissions.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go run ./cmd/appsctl aws <span style="color:#366">test</span> lambda
go run ./cmd/appsctl aws <span style="color:#366">test</span> s3
</code></pre></div><h2 id="deploying-an-app-to-aws">Deploying an app to AWS&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#deploying-an-app-to-aws"></i></a> </h2>
<p>After setting up your Mattermost instance, AWS key, and S3 bucket you can now provision your app using <code>appsctl</code>. Note that <code>appsctl</code> commands are run in the <code>mattermost-plugin-apps</code> repo.</p>
<h3 id="install-appsctl">Install appsctl&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#install-appsctl"></i></a> </h3>
<p><code>go install github.com/mattermost/mattermost-plugin-apps/cmd/appsctl@latest</code></p>
<h3 id="provision-your-app">Provision your app&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#provision-your-app"></i></a> </h3>
<p><code>appsctl provision app /PATH/TO/YOUR/APP/BUNDLE.zip</code></p>
<h3 id="install-your-app">Install your app&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#install-your-app"></i></a> </h3>
<p>The provision command output will show the Mattermost <code>/apps install</code> installation command. You can also install a previously provisioned app with the same <code>/apps install</code> command. (Example: <code>/apps install aws hello-lambda demo</code>)</p>
<h1 id="provisioned-app-details">Provisioned app details&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#provisioned-app-details"></i></a> </h1>
<p>AWS Lambda functions have semantic names, which means that a function described in the <code>manifest.json</code> file translates to AWS as <code>$appID_$appVersion_$functionName</code> to avoid collisions with other apps&rsquo; or other versions&rsquo; functions. <strong>appsctl</strong> provisions lambda functions using this name. For example the name of a <code>servicenow</code> app&rsquo;s lambda function might be <code>com-mattermost-servicenow_0-1-0_go-function</code>. <strong>appsctl</strong> handles naming the AWS Lambda functions. The dedicated S3 bucket name is stored in the environment variable: <code>MM_APPS_S3_BUCKET</code>.</p>
<p>This also stores all apps&rsquo; static assets and manifest files.</p>
<p>All files in the static folder of the bundle are considered to be the app&rsquo;s static assets and are stored in the above-mentioned bucket. Stored assets also have semantic keys and are generated using the rule - <code>static/$appID_$appVersion/filename</code>. For example the <code>servicenow</code> app&rsquo;s static file key can be accessed at <code>&quot;static/com.mattermost.servicenow_0.1.0_app/photo.png&quot;</code>.</p>
<p>The <code>manifest.json</code> file of an app is stored in the same S3 bucket as the key - <code>manifests/$appID_$appVersion.json</code>.</p>
<p><img src="provisioning-in-3rd-party-aws.png" alt="Flow of provisioning custom apps to AWS"></p>
<h1 id="provisioning-in-mattermost-cloud">Provisioning in Mattermost Cloud&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#provisioning-in-mattermost-cloud"></i></a> </h1>
<p>In order to be provisioned in Mattermost Cloud an app bundle is uploaded to the specific S3 bucket. On a new app release, a bundle is created by GitLab CI and uploaded to S3. The <a href="https://github.com/mattermost/mattermost-apps-cloud-deployer">Mattermost apps cloud deployer</a>, running as a k8s cron job every hour, detects the S3 upload, and creates appropriate lambda functions, assets, and manifest the same way the <strong>appsclt</strong> does for the third-party accounts.</p>
<p>The deployer needs lambda function names, asset keys, and the manifest key to provision the app. It calls the <code>aws.GetProvisionDataFromFile(/PATH/TO/THE/APP/BUNDLE)</code> from the Apps Plugin to get the provision data. Same data can be generated using the command:</p>
<p><code>appsctl generate-terraform-data /PATH/TO/YOUR/APP/BUNDLE</code></p>
<p><img src="provisioning-in-mm-aws.png" alt="Flow of provisioning in Mattermost Cloud"></p>


                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script src="https://developers.mattermost.com/js/tabs.js"></script>
<script src="https://developers.mattermost.com/js/main.js"></script>

</body>
</html>
