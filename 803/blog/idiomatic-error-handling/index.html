<!DOCTYPE html>





<html>

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title> Go: Idiomatic Error Handling</title>
<meta name="viewport" content="width=device-width, initial-scale=1">  
<meta http-equiv="content-language" content="en-us" />

<meta name="og:site_name" value="Mattermost.com">
<meta name="og:title" value="Go: Idiomatic Error Handling">

 
  <meta name="description" content="At Mattermost, we’re in the midst of an epic to make our error handling code more idiomatic and thus ultimately more accessible.">
<meta name="twitter:description" content="At Mattermost, we’re in the midst of an epic to make our error handling code more idiomatic and thus ultimately more accessible.">
<meta name="og:description" content="At Mattermost, we’re in the midst of an epic to make our error handling code more idiomatic and thus ultimately more accessible.">



 
<link rel="canonical" href="https://developers.mattermost.com/blog/idiomatic-error-handling/">


<link rel="shortcut icon" type="image/png" href="https://developers.mattermost.com/img/favicon-32x32.png" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">


<link rel="stylesheet" href="https://developers.mattermost.com/css/bootstrap.min.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/tabs.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/bar.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/styles.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/code.css">
<link rel="stylesheet" href="https://developers.mattermost.com/css/note.css">

<script async defer src="https://buttons.github.io/buttons.js"></script>


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53S4TVZ');</script>


</head>

<body class="blog-single">
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53S4TVZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    
<header class="with-notification-bar">

    <a href="https://developers.mattermost.com/"><img src="https://developers.mattermost.com/img/logo.svg" alt="Mattermost Logo" width="212px"></a>
    <div class="header__menu-toggle">
        <i class="fa fa-bars"></i>
    </div>
    <ul class="header__links--right">
        <li><a href="https://developers.mattermost.com/">Home</a></li>
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/contribute/getting-started/">Contribute</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/integrate/getting-started/">Integrate</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://developers.mattermost.com/extend/getting-started/">Extend</a></li>
                
            
        
            
            
            
                
                    <li class="active"><a href="https://developers.mattermost.com/blog/">Blog</a></li>
                
            
        
            
            
            
                
                    <li><a href="https://docs.mattermost.com/">Admin Docs</a></li>
                
            
        
    </ul>
</header>


<div class='notification-bar sticky-top'>
    <div class="notification-bar__content">
        <a class="notification-bar__close">
            <span aria-hidden="true">×</span>
        </a>
        <a href="https://mattermost.com/careers">
            We&#39;re hiring!
        </a>
    </div>
</div>




    <div class="container">
        <div class="row">
            <div class="col-md-9 doc-content">
                <div class="well well-sm">
                    <div class="blog-item__header">
                        <div class="blog-item__title">
                            <h1>
                            
                                Go: Idiomatic Error Handling
                            
                            </h1>
                            <small>At Mattermost, we’re in the midst of an epic to make our error handling code more idiomatic and thus ultimately more accessible.</small>
                            
                        </div>
                        <div class="blog-item__info">
                            October 18, 2018
                            <small class="blog-item__count">477 words</small>
                        </div>
                    </div>
                    <hr>
                    <p>Go is an extremely opinionated programming language. <code>import</code> something in a file that&rsquo;s not used? It won&rsquo;t compile, and there&rsquo;s no flag to override. While there are <a href="https://godoc.org/golang.org/x/tools/cmd/goimports">workarounds</a>, the end result remains the same: Go files are never cluttered by unused imports. This is true for all Go code everywhere, making every Go project more accessible.</p>
<p>Not all Go opinions are enforced by the compiler. Some are documented in <a href="https://golang.org/doc/effective_go.html">Effective Go</a>, and yet others are reflected only in the coding style of the Go <a href="https://golang.org/pkg/">standard library</a>. This body of opinions defines idiomatic Go: the natural way to write Go code.</p>
<p>Here at Mattermost, we&rsquo;re in the midst of an <a href="https://mattermost.atlassian.net/browse/MM-12535">epic</a> to make our error handling code more idiomatic and thus ultimately more accessible. The changes are simple, and best summarized by a section on the <a href="https://golang.org/doc/effective_go.html#if">Effective Go</a> document:</p>
<blockquote>
<p>In the Go libraries, you&rsquo;ll find that when an if statement doesn&rsquo;t flow into the next statement—that is, the body ends in break, continue, goto, or return—the unnecessary else is omitted.</p>
</blockquote>
<blockquote>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"></code></pre></div></blockquote>
<p>f, err := os.Open(name)
if err != nil {
return err
}
codeUsing(f)</p>
<pre><code>
&gt; This is an example of a common situation where code must guard against a sequence of error conditions. The code reads well if the successful flow of control runs down the page, eliminating error cases as they arise. Since error cases tend to end in return statements, the resulting code needs no else statements.

&gt; ```go
f, err := os.Open(name)
if err != nil {
    return err
}
d, err := f.Stat()
if err != nil {
    f.Close()
    return err
}
codeUsing(f, d)
</code></pre><h3 id="real-life-example">Real-life Example&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#real-life-example"></i></a> </h3>
<p>Here&rsquo;s a block of code <a href="https://github.com/jespino/platform/blob/a257d501df3d0624f9cc52efb602e7d9d2a4dc07/app/notification.go#L38-L43">handling notifications</a> before it was changed:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">var</span> profileMap <span style="color:#069;font-weight:bold">map</span>[<span style="color:#078;font-weight:bold">string</span>]<span style="color:#555">*</span>model.User
<span style="color:#069;font-weight:bold">if</span> result <span style="color:#555">:=</span> <span style="color:#555">&lt;-</span>pchan; result.Err <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>, result.Err
} <span style="color:#069;font-weight:bold">else</span> {
    profileMap = result.Data.(<span style="color:#069;font-weight:bold">map</span>[<span style="color:#078;font-weight:bold">string</span>]<span style="color:#555">*</span>model.User)
}
</code></pre></div><p>Notice the <code>if</code> statement ending in a <code>return</code>, making the <code>else</code> unnecessary. Here&rsquo;s the code <a href="https://github.com/jespino/platform/blob/2ab1b82d18af545f8483daa1f22af057eb37b879/app/notification.go#L38-L42">written idiomatically</a>:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">result <span style="color:#555">:=</span> <span style="color:#555">&lt;-</span>pchan
<span style="color:#069;font-weight:bold">if</span> result.Err <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>, result.Err
}
profileMap <span style="color:#555">:=</span> result.Data.(<span style="color:#069;font-weight:bold">map</span>[<span style="color:#078;font-weight:bold">string</span>]<span style="color:#555">*</span>model.User)
</code></pre></div><p>Eliminating the <code>else</code> condition required pre-declaring <code>result</code> instead of defining it inline. While this is but a minor improvement, frequently that <code>else</code> block is much longer with nested conditional statements of its own.</p>
<h3 id="is-it-ok-to-still-declare-variables-inline-to-a-conditional">Is it ok to still declare variables inline to a conditional?&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#is-it-ok-to-still-declare-variables-inline-to-a-conditional"></i></a> </h3>
<p>Idiomatic go still allows for variables declared inline with the conditional. Only variables that need to be used outside the conditional should be pre-declared. Here&rsquo;s a correct <a href="https://github.com/mattermost/mattermost-server/blob/ebd540d5fbc10bdc504f7349acbb90ddc4b5e826/app/scheme.go#L13-L15">example</a> of writing idiomatic Go code using a single inline variable:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">if</span> err <span style="color:#555">:=</span> a.<span style="color:#c0f">IsPhase2MigrationCompleted</span>(); err <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">nil</span>, err
}
</code></pre></div><p>and a correct <a href="https://github.com/mattermost/mattermost-server/blob/5d6d4502992af4120fed19a9db43960d6269b871/store/local_cache_supplier.go#L69-L76">example</a> using multiple inline variables:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">if</span> cacheItem, ok <span style="color:#555">:=</span> cache.<span style="color:#c0f">Get</span>(key); ok {
    <span style="color:#069;font-weight:bold">if</span> s.metrics <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">nil</span> {
        s.metrics.<span style="color:#c0f">IncrementMemCacheHitCounter</span>(cache.<span style="color:#c0f">Name</span>())
    }
    result <span style="color:#555">:=</span> <span style="color:#c0f">NewSupplierResult</span>()
    result.Data = cacheItem
    <span style="color:#069;font-weight:bold">return</span> result
}
</code></pre></div><h3 id="contributing">Contributing&nbsp;<a class="hanchor fa fa-link" ariaLabel="Anchor" href="#contributing"></i></a> </h3>
<p>Interested in helping us complete these changes? Find an unclaimed <a href="https://mattermost.atlassian.net/browse/MM-12535">ticket</a>, and join us on <a href="https://community.mattermost.com/core/channels/developers">community.mattermost.com</a> to discuss further.</p>


                    <hr>
                    
                    Written by
                    
                    Jesse Hallam
-
<a href="https://community.mattermost.com/core/messages/@jesse.hallam" target="_blank">
    @jesse.hallam
</a>
on
<a href="https://community.mattermost.com/signup_user_complete" target="_blank">
    community.mattermost.com
</a>
and
<a href="https://github.com/lieut-data" target="_blank">
    @lieut-data
</a>
on GitHub

                    
                    
                    <br />
                    <br />
                    Join us on <a href="https://community.mattermost.com/signup_user_complete"
                        target="_blank">community.mattermost.com</a>!
                </div>
            </div>

            
            <div class="col-md-3 doc-content tags-sidebar">
                <div class="well well-sm">

                    


                    <h6>Other Posts</h6>
                    <ul class="list-unstyled">
                        
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/migrating-thousands-of-mattermost-installations-to-new-kubernetes-custom-resources/">Migrating thousands of Mattermost installations to new Kubernetes Custom Resources</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/optimizing-go-compiler-3/">Fixing a bug in the Go compiler as a newbie: a deep dive (III)</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/optimizing-go-compiler-2/">Fixing a bug in the Go compiler as a newbie: a deep dive (II)</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/optimizing-go-compiler-1/">Fixing a bug in the Go compiler as a newbie: a deep dive (I)</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/automating-nodes-rotation/">Automating Nodes Rotation Using Gitlab Pipelines</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/streamlining-developer-access-to-prometheus-and-grafana/">Streamlining Developer Access to Prometheus and Grafana</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/common-i18n-mistakes/">Avoiding Common Internationalization Mistakes</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/mysql-index-merge/">Tuning MySQL and the Ghost of Index Merge Intersection</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/docker-content-trust-in-gitlab-with-delegation/">Docker Content Trust in GitLab&#39;s .gitlab-ci.yml with Delegation</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/improving-performance-through-load-testing/">Improving performance (and more) through load testing</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/automated-ui-testing-with-cypress/">Automated UI Testing With Cypress</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/pritunl/">From OpenVPN to Pritunl VPN: The transition</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/open-tracing/">OpenTracing for Go Projects</a></li>
                        
                        
                        
                        <li class="blog-item__sidebar">- <a href="https://developers.mattermost.com/blog/hands-on-iouring-go/">Getting Hands-on with io_uring using Go</a></li>
                        
                        
                    </ul>
                    <h6>Categories</h6>
                    <ul class="list-unstyled">
                        
                    <li>- <a href="https://developers.mattermost.com/categories/go">Go</a></li>
                           
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <footer class="text-center">
    <div class="container-fluid">
        <div class="footer__copyright">© Mattermost, Inc. All Rights Reserved.</div>
        <div class="footer__icons">
            <a href="https://www.facebook.com/Mattermost-2300985916642531/" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/mattermost" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-twitter"></i></a>
            <a href="https://www.youtube.com/channel/UCNR05H72hi692y01bWaFXNA" target="_blank" rel="noopener noreferrer" class="btn-primary"><i class="fa fa-youtube"></i></a>
        </div>
    </div>
</footer>


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script src="https://developers.mattermost.com/js/tabs.js"></script>
<script src="https://developers.mattermost.com/js/main.js"></script>

</body>

</html>
